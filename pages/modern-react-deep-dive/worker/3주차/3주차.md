# 서버 사이드 렌더링

## [SPA, SSR, MPA 를 정리한 글](https://learning-react-study.vercel.app/learning-react-study/oliv/chapter13)

## SSR?

SPA 방식의 어플리케이션은 확장될수록 점점 페이지 초기 로딩 시간이 느려지는 문제를 SPA 의 태생적인 한계에서 찾았고, 기존의 MPA 방식으로 다시 회귀중이다.

사용자 기기의 성능에 영향을 받는 CSR 대신 웹 페이지 렌더링 책임을 서버에 두어 안정적인 렌더링이 가능하다

### SSR 의 장점

1. 서버의 리소스가 충분히 확보된 경우 최초 페이지 진입이 비교적 빠르다
   - 랜딩 페이지가 외부 API 호출이 많은 페이지인 경우 CSR 은 JS 와 리소스를 다운받는 시간이 소요 된다.

2. SEO 와 SNS 공유 등 메타 데이터 제공이 쉽다
   - 검색 엔진의 bot 은 HTML 정보만 다운로드하고 JS를 실행하지 않는다. HTML 페이지 내부 메타 태그 및 오픈 그래프 정보를 기반으로 검색엔진에 저장한다. 
   - SSR 은 서버에서 HTML 파일을 렌더링하여 제공하기 때문에 SEO 에 유리
3. 보안에 좀 더 안전하다.
   - JAM 스택을 채택한 프로젝트의 공통된 문제점은 어플리케이션의 모든 활동이 브라우저에 노출된다는 것이다.
   - 인증 인가와 같은 민감한 작업을 서버에서 수행하여 노출을 최소화 할 수 있다.

### SSR 단점

1. 소스코드를 작성할 때 항상 서버를 고려해야 한다.
   - window, sessionStorage 등 브라우저 API 를 서버에서 실행할 수 없다. 전역 객체에 의존하는 라이브러리 또한 마찬가지.

2. 적절한 서버가 구축되어 있어야 한다.
   - SPA 와 정적 페이지 서비스는 단순히 HTML, CSS, JS 를 다운할 수 있는 서버만 준비하면 된다.
   - SSR 은 사용자의 요청을 받아 렌더링을 수행할 서버가 필요하다.
   - 서버 구축과 운영은 쉽지않다.

3. 서비스 지연에 따른 문제
   - SPA 는 느린 작업을 수행시 최초에 어떤 화면이라도 보여준 상태에서 느린 작업이 수행되기 때문에 적절하게 작업이 진행중인 것을 표시만 한다면 사용자가 작업이 완료되기 까지 대기할 여지가 있다
   - SSR 에서 최초 렌더링에서 지연이 일어난다면 사용자에게 어떤 정보도 제공할 수 없다

### SPA SSR 둘 다 알아야 한다.

- 가장 뛰어난 SPA 는 가장 뛰어난 MPA 보다 성능이 좋다.
- 평균적인 SPA 는 평균적인 MPA 보다 느리다.

# React v19 의 SEO

React 19 버전 부터 컴포넌트에서 `<title>`, `<meta>`,`<link>`,`<script>`,`<style>` 태그를 직접 사용할 수 있다.

## `<meta>`
[공식문서](https://react.dev/reference/react-dom/components/meta#meta)

### Reference
doucument meta data 를 추가하려면 `<meta>` 컴포넌트를 사용한다. 모든 컴포넌트에서 `<meta>` 를 렌더링할 수 있으며 React는 항상 해당 DOM 요소를 문서 헤드에 배치한다.

```HTML
<meta name="keywords" content="React, JavaScript, semantic markup, html" />
```
#### Props
`<meta>` 는 모든 [common element props](https://react.dev/reference/react-dom/components/common#props) 를 지원한다.

name, httpEquiv, charset, itemProp prop 중 정확히 하나가 있어야 한다.

`<meta>` 컴포넌트는 이러한 props 중 어떤 것이 지정되었는지에 따라 다른 작업을 수행한다.

- name: string. 문서에 첨부할 [메타데이터의 종류](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta/name)를 지정한다.

- charset: string. 문서에서 사용되는 charset 을 지정한다. 유효한 값은 "utf-8"뿐.

- httpEquiv: string. 문서 처리를 위한 지시문을 지정한다.

- itemProp: string. 문서 전체가 아닌 문서 내의 특정 항목에 대한 메타데이터를 지정한다.

- content: string. name 또는 itemProp prop 과 함께 사용될 때 첨부될 메타데이터를 지정하거나 httpEquiv prop 과 함께 사용될 때 지시문의 동작을 지정한다.

#### 렌더링 중 특수 처리

React는 React 트리에서 렌더링되는 위치에 관계없이 항상 문서의 `<head>` 내에 `<meta>` 컴포넌트에 해당하는 DOM 요소를 배치한다.

`<meta>` 에 itemProp props 가 있는 경우, 문서에 대한 메타데이터가 아니라 페이지의 특정 부분에 대한 메타 데이터를 나타내기 때문에 React는 이러한 `<meta>` 컴포넌트를 `<head>` 문서 내에 배치하지 않고 다른 React 컴포넌트처럼 배치한다.

### Usage

#### 메타데이터로 문서에 주석 달기

[예제링크](https://codesandbox.io/s/6gdxf2?file=%2Fsrc%2FApp.js&utm_medium=sandpack)

keywords, summary, 작성자 이름 등의 메타데이터로 문서에 주석을 달 수 있다.

```HTML
<meta name="author" content="John Smith" />
<meta name="keywords" content="React, JavaScript, semantic markup, html" />
<meta name="description" content="API reference for the <meta> component in React DOM" />
```

#### 메타데이터로 문서 내의 특정 항목에 주석 달기

itemProp props 를 사용해 `<meta>` 컴포넌트를 사용하여 메타데이터로 문서 내의 특정 항목에 주석을 달 수 있다.
`<head>` 문서 내에 배치하지 않고 다른 React 컴포넌트처럼 배치한다.

```HTML
<section itemScope>
  <h3>Annotating specific items</h3>
  <meta itemProp="description" content="API reference for using <meta> with itemProp" />
  <p>...</p>
</section>
```

## `<link>`
[공식문서](https://react.dev/reference/react-dom/components/link)

`<link>` 컴포넌트를 사용하면 스타일시트와 같은 외부 리소스를 사용하거나 링크 메타데이터로 문서에 주석을 달 수 있다
### Reference
스타일시트, 글꼴, 아이콘과 같은 외부 리소스에 연결하거나 링크 메타데이터로 문서에 주석을 추가하려면 `<link>` 컴포넌트를 사용한다.

모든 컴포넌트에서 `<link>` 를 렌더링할 수 있으며 React 는 대부분의 경우 `<link>` 를 문서 `<head>` 에 배치한다.

```HTML
<link rel="icon" href="favicon.ico" />
```
#### Props

`<link>` 는 모든 [common element props](https://react.dev/reference/react-dom/components/common#props) 를 지원한다.

- rel: string, **필수**. 리소스와의 관계를 지정한다. React 는 rel="stylesheet"가 포함된 링크를 다른 링크와 다르게 처리한다.

   - rel="stylesheet" 일 때 적용되는 props

      - precedence: string. 
         - `<head>` 문서의 다른 항목과 비교하여 `<link>` DOM 노드의 순위를 React 에게 알려준다.
         - 우선순위에 따라 **"reset"**, **"low"**, **"medium"**, **"high"** 의 값을 가진다. 
         - 동일한 우선순위를 가진 스타일시트는 `<link>` 태그인지, 인라인 `<style>` 태그인지, **preload** 또는 **preinit** 기능을 사용하여 로드되었는지에 관계없이 함께 사용된다.
         
      - media: string. 스프레드시트를 특정 미디어 쿼리로 제한한다.

      - title : string. [대체 스타일시트](https://developer.mozilla.org/en-US/docs/Web/CSS/Alternative_style_sheets)의 이름을 지정한다.

   - rel="stylesheet"일 때 적용되나 React의 스타일시트 특별 처리를 비활성화하는 props.

      - disabled: boolean. 스프레드시트를 비활성화 한다. 
      - onError: function. 스타일시트를 로드하지 못한 경우 호출된다. 
      - onLoad: function. 스타일시트 로드가 완료되면 호출된다.

   -  rel="preload" 또는 rel="modulepreload"일 때 적용되는 props.

      - as: string. 리소스 유형. 가능한 값은 audio, document, embed, fetch, font, 
      image, object, script, style, track, video, worker.

      - imageSrcSet: string. as="image"인 경우에만 적용된다. 이미지의 소스 세트를 지정한다

      - imageSizes: string. as="image"인 경우에만 적용된다. 이미지의 크기를 지정한다.

   - rel="icon" 또는 rel="apple-touch-icon"일 때 적용되는 props.

      - sizes: string. 아이콘의 크기.

   - 모든 경우에 적용되는 props.

      - href: string. 연결된 리소스의 URL.

      - crossOrigin: string. 사용할 CORS 정책. 가능한 값은 익명 및 사용 자격 증명. as가 "fetch"로 설정된 경우 필수.

      - referrerPolicy: string. 가져올 때 보낼 Referrer 헤더. 가능한 값은 no-referrer-when-downgrade(기본값), no-referrer, Origin, Origin-when-cross-Origin 및 unsafe-url.

      - fetchPriority: string. 리소스 가져오기에 대한 상대적 우선순위를 제안한다. 가능한 값은 auto(기본값), high 및 low.

      - hrefLang: string. 연결된 리소스의 언어. 

      - integrity: string. 진위 여부를 확인하기 위한 리소스의 암호화 해시. 

      - type: string. 연결된 리소스의 MIME 유형.

   - React와 함께 사용하지 않는 것이 좋은 props.
      - blocking: string. "render" 로 설정하면 스타일시트가 로드될 때까지 페이지를 렌더링하지 않도록 브라우저에 지시한다. React.Suspense를 사용하는 것이 좋다.
   
#### 렌더링 중 특수 처리

React는 렌더링되는 React 트리의 위치에 관계없이 항상 문서의 `<head>` 내에 `<link>` 컴포넌트에 해당하는 DOM 요소를 배치합니다.

#### 몇 가지 예외 사항

- `<link>` 에 rel="stylesheet" props 가 있는 경우 문서의 `<head>`에 추가되려면 precedence 관련 props 도 있어야 합니다.

   이는 문서 내에서 스타일시트의 순서가 중요하기 때문에 React는 다른 스타일시트와 관련하여 이 스타일시트의 순서를 어떻게 지정해야 하는지 알아야 하며, 이는 precedence props 를 사용하여 지정한다.

   precedence prop이 생략되면 특별한 동작은 없습니다.

- `<link>` 에 itemProp props 가 있는 경우 문서의 `<head>`에 추가하지 않는다. 이 경우 문서에 적용되지 않는 대신 페이지의 특정 부분에 대한 메타데이터를 나타내기 때문이다.

- `<link>` 에 onLoad 또는 onError props 가 있는 경우 문서의 `<head>`에 추가하지 않는다. React 컴포넌트 내에서 연결된 리소스의 로드를 수동으로 관리하고 있기 때문이다.

### 스타일 시트에 대한 특수 처리

또한 <`link>` 가 스타일시트에 대한 것인 경우(즉, props에 rel="stylesheet") React는 이를 다음과 같은 방식으로 특별히 처리한다.

- `<link>` 를 렌더링하는 컴포넌트는 스타일시트가 로드되는 동안 일시중단 된다.

- 여러 컴포넌트가 동일한 스타일시트에 대한 링크를 렌더링하는 경우 React는 해당 중복을 제거하고 하나의 링크만 추가한다. 두 개의 링크가 동일한 href 속성을 갖고 있으면 동일한 것으로 간주한다.

#### 두 가지 주의 사항
- React는 `<link>` 컴포넌트가 렌더링된 후 props 의 변경 사항을 무시합니다. 

- React는 `<link>` 컴포넌트를 렌더링한 컴포넌트가 마운트 해제된 후에도 DOM에 `<link>` 컴포넌트를 남길 수 있다.

#### 두 가지 예외 사항

- `<link>` 컴포넌트에 precedence 관련 props 이 없으면 문서 내 스타일시트의 순서가 중요하므로 스타일 시트에 대한 특수 처리를 수행하지 않는다.
그래서 React는 다른 스타일시트와 관련하여 이 스타일시트를 정렬하는 방법을 알아야 하며, 이는 precedence 관련 props 을 사용하여 지정합니다.

- onLoad, onError 또는 disabled props 를 제공하는 경우 스타일 시트에 대한 특수 처리를 수행하지 않는다. 이러한 props 는 컴포넌트 내에서 스타일시트 로드를 수동으로 관리하고 있음을 나타내기 때문이다.


### Usage

#### Linking to related resources 

[예제링크](https://codesandbox.io/s/htpzgz?file=%2Fsrc%2FApp.js&utm_medium=sandpack)

icon, canonical URL, 또는 pingback과 같은 관련 리소스에 대한 링크로 문서에 주석을 달 수 있다

```typescript
import ShowRenderedHTML from './ShowRenderedHTML.js';

export default function BlogPage() {
   return (
      <ShowRenderedHTML>
      <link rel="icon" href="favicon.ico" />
      <link rel="pingback" href="http://www.example.com/xmlrpc.php" />
      <h1>My Blog</h1>
      <p>...</p>
    </ShowRenderedHTML>
  );
}
```

#### Linking to a stylesheet 

[예제링크](https://codesandbox.io/s/q3m693?file=%2Fsrc%2FApp.js&utm_medium=sandpack)

컴포넌트가 특정 스타일시트에 의존하는 경우 컴포넌트 내에서 해당 스타일시트에 대한 링크를 렌더링할 수 있다.

스타일시트가 로드되는 동안 구성요소가 일시중단됩니다. 

이 스타일시트를 다른 스타일시트와 비교하여 어디에 배치할지 React에게 알려주는 precedence props 를 제공해야 합니다. 우선순위가 높은 스타일시트는 우선순위가 낮은 스타일시트를 재정의할 수 있습니다.

스타일시트를 사용하려는 경우 preinit 함수를 호출하면 브라우저가 <link> 컴포넌트 렌더링 보다 더 일찍 스타일시트를 fetch 할 수 있다.

```typescript
import ShowRenderedHTML from './ShowRenderedHTML.js';

export default function SiteMapPage() {
  return (
    <ShowRenderedHTML>
      <link rel="stylesheet" href="sitemap.css" precedence="medium" />
      <p>...</p>
    </ShowRenderedHTML>
  );
}
```

#### Controlling stylesheet precedence

[예제링크](https://codesandbox.io/s/n27jzp?file=%2Fsrc%2FApp.js&utm_medium=sandpack)
스타일시트는 서로 충돌할 수 있으며 충돌이 발생하면 브라우저는 문서의 후순위에 나오는 스타일시트를 따른다.

precedence prop 를 사용하여 스타일시트의 순서를 제어할 수 있다.

```typescript
import ShowRenderedHTML from './ShowRenderedHTML.js';

export default function HomePage() {
  return (
    <ShowRenderedHTML>
      <FirstComponent />
      <SecondComponent />
      ...
    </ShowRenderedHTML>
  );
}

function FirstComponent() {
  return <link rel="stylesheet" href="first.css" precedence="high" />;
}

function SecondComponent() {
  return <link rel="stylesheet" href="second.css" precedence="low" />;
}
```

#### Deduplicated stylesheet rendering 
[예제링크](https://codesandbox.io/s/z6742w?file=%2Fsrc%2FApp.js&utm_medium=sandpack)

여러 컴포넌트에서 동일한 스타일시트를 렌더링하는 경우 React는 문서 `<head>` 에 하나의 `<link>` 만 배치한다.

```typescript
import ShowRenderedHTML from './ShowRenderedHTML.js';

export default function HomePage() {
  return (
    <ShowRenderedHTML>
      <Component />
      <Component />
      ...
    </ShowRenderedHTML>
  );
}

function Component() {
  return <link rel="stylesheet" href="styles.css" precedence="medium" />;
}
```

#### Annotating specific items within the document with links 

itemProp props 와 함께 `<link>` 컴포넌트를 사용하여 관련 리소스에 대한 링크로 문서 내의 특정 항목에 주석을 달 수 있다.

React는 이러한 주석을 `<head>` 문서 내에 배치하지 않고 다른 React 컴포넌트처럼 배치한다.


```HTML
<section itemScope>
  <h3>Annotating specific items</h3>
  <link itemProp="author" href="http://example.com/" />
  <p>...</p>
</section>
```

## `<script>`
[공식문서](https://react.dev/reference/react-dom/components/script)

### Reference
### Usage

## `<style>`
[공식문서](https://react.dev/reference/react-dom/components/style)
### Reference
### Usage
## `<title>`
[공식문서](https://react.dev/reference/react-dom/components/title)
### Reference
### Usage